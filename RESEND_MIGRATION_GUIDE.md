# Resend é‚®ä»¶æœåŠ¡è¿ç§»æŒ‡å—

## æ¦‚è¿°

æœ¬é¡¹ç›®å·²å°†é‚®ä»¶éªŒè¯ç å‘é€åŠŸèƒ½ä» Supabase Auth è¿ç§»è‡³ Resend é‚®ä»¶æœåŠ¡ï¼Œä»¥æä¾›æ›´å¥½çš„é‚®ä»¶å‘é€ä½“éªŒå’Œæ›´å¤šçš„è‡ªå®šä¹‰é€‰é¡¹ã€‚

## å·²å®Œæˆçš„æ›´æ”¹

### 1. æ–°å¢æ–‡ä»¶

- `src/lib/resend.ts` - Resend é‚®ä»¶æœåŠ¡é…ç½®å’Œæ¨¡æ¿
- `src/app/api/auth/send-email-code/route.ts` - é‚®ä»¶éªŒè¯ç å‘é€API
- `src/api/resendAuth.ts` - Resend è®¤è¯APIå°è£…

### 2. ä¿®æ”¹æ–‡ä»¶

- `src/api/auth.ts` - æ›´æ–°é‚®ç®±éªŒè¯ç å‘é€é€»è¾‘ï¼Œä½¿ç”¨ Resend æ›¿ä»£ Supabase
- `src/api/supabaseAuth.ts` - ç¦ç”¨ Supabase é‚®ä»¶å‘é€åŠŸèƒ½
- `.env.local` - æ·»åŠ  Resend é…ç½®

### 3. ç¯å¢ƒå˜é‡

```bash
# Resend é‚®ä»¶æœåŠ¡é…ç½®
RESEND_API_KEY=re_fPd6tQcm_8wpouJHDk3Gqo9nh9gHKLJCY
RESEND_FROM_EMAIL=noreply@greendev.org.cn
NEXT_PUBLIC_USE_RESEND_EMAIL=true
```

## åŠŸèƒ½å¯¹æ¯”

### åŸ Supabase é‚®ä»¶åŠŸèƒ½
- âŒ é‚®ä»¶æ¨¡æ¿å›ºå®šï¼Œæ— æ³•è‡ªå®šä¹‰
- âŒ å‘é€åœ°å€å›ºå®šä¸º noreply@mail.app.supabase.co
- âŒ é‚®ä»¶æ ·å¼æ— æ³•å®Œå…¨æ§åˆ¶
- âœ… ä¸ Supabase Auth æ·±åº¦é›†æˆ

### æ–° Resend é‚®ä»¶åŠŸèƒ½
- âœ… å®Œå…¨è‡ªå®šä¹‰é‚®ä»¶æ¨¡æ¿å’Œæ ·å¼
- âœ… ä½¿ç”¨è‡ªå®šä¹‰åŸŸåå‘é€é‚®ä»¶ (noreply@greendev.org.cn)
- âœ… æ›´å¥½çš„é€è¾¾ç‡å’Œé‚®ä»¶ç»Ÿè®¡
- âœ… æ”¯æŒå¤šç§é‚®ä»¶æ¨¡æ¿ï¼ˆæ³¨å†Œã€ç™»å½•ã€é‡ç½®å¯†ç ï¼‰
- âœ… æ›´çµæ´»çš„éªŒè¯ç ç®¡ç†

## é‚®ä»¶æ¨¡æ¿

é¡¹ç›®æä¾›ä¸‰ç§é‚®ä»¶æ¨¡æ¿ï¼š

1. **æ³¨å†ŒéªŒè¯ç ** - ç”¨æˆ·æ³¨å†Œæ—¶çš„é‚®ç®±éªŒè¯
2. **ç™»å½•éªŒè¯ç ** - é‚®ç®±éªŒè¯ç ç™»å½•
3. **é‡ç½®å¯†ç éªŒè¯ç ** - å¿˜è®°å¯†ç æ—¶çš„éªŒè¯ç 

æ¯ä¸ªæ¨¡æ¿éƒ½åŒ…å«ï¼š
- ç¾è§‚çš„HTMLæ ¼å¼é‚®ä»¶
- çº¯æ–‡æœ¬å¤‡ç”¨ç‰ˆæœ¬
- ç»¿è‰²æŠ€æœ¯å¹³å°å“ç‰Œé£æ ¼
- 6ä½æ•°å­—éªŒè¯ç 
- 5åˆ†é’Ÿæœ‰æ•ˆæœŸæé†’

## éªŒè¯ç ç®¡ç†

### å­˜å‚¨æœºåˆ¶
- ä½¿ç”¨å†…å­˜å­˜å‚¨éªŒè¯ç ï¼ˆé€‚ç”¨äºå¼€å‘ç¯å¢ƒï¼‰
- ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ Redis æˆ–æ•°æ®åº“å­˜å‚¨

### å®‰å…¨ç‰¹æ€§
- éªŒè¯ç æœ‰æ•ˆæœŸï¼š5åˆ†é’Ÿ
- å‘é€å†·å´æ—¶é—´ï¼š60ç§’
- é”™è¯¯å°è¯•é™åˆ¶ï¼šæœ€å¤š3æ¬¡
- è‡ªåŠ¨æ¸…ç†è¿‡æœŸéªŒè¯ç 

## API æ¥å£

### å‘é€é‚®ç®±éªŒè¯ç 
```typescript
POST /api/auth/send-email-code
{
  "email": "user@example.com",
  "purpose": "reset_password" | "register" | "login"
}
```

### éªŒè¯é‚®ç®±éªŒè¯ç 
```typescript
PUT /api/auth/send-email-code
{
  "email": "user@example.com",
  "code": "123456",
  "purpose": "reset_password" | "register" | "login"
}
```

## è¿ç§»å½±å“

### âœ… ä¸å—å½±å“çš„åŠŸèƒ½
- æ‰‹æœºéªŒè¯ç å‘é€ï¼ˆä»ä½¿ç”¨ Supabaseï¼‰
- å¯†ç ç™»å½•
- ç”¨æˆ·æ³¨å†Œå’Œç™»å½•æµç¨‹
- ç”¨æˆ·ä¼šè¯ç®¡ç†

### ğŸ”„ å·²å‡çº§çš„åŠŸèƒ½
- é‚®ç®±éªŒè¯ç å‘é€ï¼ˆä½¿ç”¨ Resendï¼‰
- é‚®ç®±éªŒè¯ç éªŒè¯ï¼ˆä½¿ç”¨æœ¬åœ°APIï¼‰
- å¿˜è®°å¯†ç é‚®ç®±éªŒè¯ï¼ˆä½¿ç”¨ Resendï¼‰

## ç¦ç”¨ Supabase é‚®ä»¶å‘é€

ä¸ºäº†å®Œå…¨é˜»æ­¢ Supabase å‘é€é‚®ä»¶ï¼Œéœ€è¦åœ¨ Supabase é¡¹ç›®è®¾ç½®ä¸­è¿›è¡Œä»¥ä¸‹é…ç½®ï¼š

### 1. ç™»å½• Supabase Dashboard
è®¿é—®ï¼šhttps://app.supabase.com/project/qpeanozckghazlzzhrni

### 2. ç¦ç”¨é‚®ä»¶æ¨¡æ¿
1. è¿›å…¥ `Authentication` > `Email Templates`
2. ç¦ç”¨ä»¥ä¸‹æ¨¡æ¿ï¼š
   - Confirm signup
   - Magic Link
   - Change Email Address
   - Reset Password

### 3. ä¿®æ”¹è®¤è¯è®¾ç½®
1. è¿›å…¥ `Authentication` > `Settings`
2. å…³é—­ `Enable email confirmations`
3. å…³é—­ `Enable email change confirmations`

## æµ‹è¯•

### æµ‹è¯•å‘é€é‡ç½®å¯†ç é‚®ä»¶
```bash
curl -X POST http://localhost:3000/api/auth/send-email-code \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","purpose":"reset_password"}'
```

### æµ‹è¯•éªŒè¯éªŒè¯ç 
```bash
curl -X PUT http://localhost:3000/api/auth/send-email-code \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","code":"123456","purpose":"reset_password"}'
```

## ç›‘æ§å’Œæ—¥å¿—

- é‚®ä»¶å‘é€ç»“æœä¼šåœ¨æœåŠ¡å™¨æ§åˆ¶å°è¾“å‡º
- éªŒè¯ç å­˜å‚¨å’ŒéªŒè¯è¿‡ç¨‹æœ‰è¯¦ç»†æ—¥å¿—
- å¯é€šè¿‡ Resend Dashboard æŸ¥çœ‹é‚®ä»¶å‘é€ç»Ÿè®¡

## ç”Ÿäº§ç¯å¢ƒå»ºè®®

1. **ä½¿ç”¨ Redis å­˜å‚¨éªŒè¯ç **
   ```bash
   npm install ioredis
   ```

2. **é…ç½®é‚®ä»¶å‘é€é™åˆ¶**
   - æ¯å°æ—¶æœ€å¤šå‘é€æ¬¡æ•°
   - æ¯å¤©æ¯é‚®ç®±æœ€å¤§å‘é€é‡

3. **ç›‘æ§é‚®ä»¶å‘é€**
   - è®¾ç½® Resend webhook ç›‘æ§é€è¾¾çŠ¶æ€
   - è®°å½•å‘é€å¤±è´¥æ—¥å¿—

4. **å®‰å…¨åŠ å›º**
   - éªŒè¯é‚®ç®±æ ¼å¼å’ŒåŸŸåç™½åå•
   - æ·»åŠ å›¾å½¢éªŒè¯ç é˜²æ­¢æ»¥ç”¨
   - IP é¢‘ç‡é™åˆ¶

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **é‚®ä»¶å‘é€å¤±è´¥**
   - æ£€æŸ¥ RESEND_API_KEY æ˜¯å¦æ­£ç¡®
   - ç¡®è®¤ RESEND_FROM_EMAIL åŸŸåå·²éªŒè¯

2. **éªŒè¯ç éªŒè¯å¤±è´¥**
   - æ£€æŸ¥éªŒè¯ç æ˜¯å¦è¿‡æœŸï¼ˆ5åˆ†é’Ÿï¼‰
   - ç¡®è®¤é‚®ç®±åœ°å€å¤§å°å†™åŒ¹é…

3. **é‚®ä»¶æœªæ”¶åˆ°**
   - æ£€æŸ¥åƒåœ¾é‚®ä»¶æ–‡ä»¶å¤¹
   - ç¡®è®¤é‚®ç®±åœ°å€æ­£ç¡®
   - æŸ¥çœ‹ Resend Dashboard å‘é€çŠ¶æ€

## å›æ»šæ–¹æ¡ˆ

å¦‚æœéœ€è¦å›æ»šåˆ° Supabase é‚®ä»¶ï¼š

1. ä¿®æ”¹ `.env.local`ï¼š
   ```bash
   NEXT_PUBLIC_USE_RESEND_EMAIL=false
   ```

2. æ¢å¤ `src/api/auth.ts` ä¸­çš„ Supabase é‚®ä»¶é€»è¾‘

3. é‡æ–°å¯ç”¨ Supabase é‚®ä»¶æ¨¡æ¿