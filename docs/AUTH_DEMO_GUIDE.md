# è®¤è¯API Mockæµ‹è¯•æ¼”ç¤ºæŒ‡å—

## ğŸ¯ å¿«é€Ÿä½“éªŒ

### ç¬¬ä¸€æ­¥ï¼šå¯ç”¨Mockæ¨¡å¼

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.env.local` æ–‡ä»¶ï¼š

```bash
# åˆ›å»ºç¯å¢ƒé…ç½®æ–‡ä»¶
touch .env.local
```

æ·»åŠ ä»¥ä¸‹å†…å®¹åˆ° `.env.local`ï¼š

```env
# å¯ç”¨Mockæ¨¡å¼è¿›è¡Œæµ‹è¯•
NEXT_PUBLIC_USE_MOCK=true

# APIåŸºç¡€URLï¼ˆMockæ¨¡å¼ä¸‹ä»…ä½œé…ç½®ï¼Œä¸ä¼šå®é™…è¯·æ±‚ï¼‰
NEXT_PUBLIC_API_URL=http://localhost:8080/api
```

### ç¬¬äºŒæ­¥ï¼šå¯åŠ¨é¡¹ç›®

```bash
# å®‰è£…ä¾èµ–ï¼ˆå¦‚æœè¿˜æœªå®‰è£…ï¼‰
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev
```

### ç¬¬ä¸‰æ­¥ï¼šè®¿é—®æµ‹è¯•é¡µé¢

åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š
```
http://localhost:3000/auth-test
```

## ğŸ§ª æµ‹è¯•åœºæ™¯æ¼”ç¤º

### ğŸ” åœºæ™¯1ï¼šå¯†ç ç™»å½•æµ‹è¯•

1. ç‚¹å‡» **"å¯†ç ç™»å½•"** æŒ‰é’®
2. è§‚å¯Ÿæµ‹è¯•æ—¥å¿—ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
   ```
   ğŸ§ª å¼€å§‹æµ‹è¯•å¯†ç ç™»å½•...
   âœ… å¯†ç ç™»å½•æˆåŠŸ: æµ‹è¯•ç”¨æˆ·
   ğŸ“„ Token: eyJhbGciOiJIUzI1NiIsInR...
   ```

### ğŸ“± åœºæ™¯2ï¼šæ‰‹æœºéªŒè¯ç ç™»å½•

1. ç‚¹å‡» **"éªŒè¯ç ç™»å½•"** æŒ‰é’®
2. è§‚å¯Ÿæ§åˆ¶å°å’Œæµ‹è¯•æ—¥å¿—ï¼š
   ```
   ğŸ§ª å¼€å§‹æµ‹è¯•æ‰‹æœºéªŒè¯ç ç™»å½•...
   ğŸ“± å‘é€æ‰‹æœºéªŒè¯ç ...
   âœ… éªŒè¯ç å‘é€æˆåŠŸ: éªŒè¯ç å·²å‘é€è‡³æ‰‹æœº +86 13800138000
   ğŸ”‘ MockéªŒè¯ç : 123456
   ğŸ” ä½¿ç”¨éªŒè¯ç ç™»å½•...
   âœ… éªŒè¯ç ç™»å½•æˆåŠŸ: ç”¨æˆ·1380
   ```

### ğŸ“§ åœºæ™¯3ï¼šé‚®ç®±æ³¨å†Œæµ‹è¯•

1. ç‚¹å‡» **"é‚®ç®±æ³¨å†Œ"** æŒ‰é’®
2. ç³»ç»Ÿä¼šç”Ÿæˆå”¯ä¸€çš„æµ‹è¯•é‚®ç®±
3. è§‚å¯Ÿå®Œæ•´çš„æ³¨å†Œæµç¨‹ï¼š
   ```
   ğŸ§ª å¼€å§‹æµ‹è¯•é‚®ç®±æ³¨å†Œ...
   ğŸ“§ å‘é€é‚®ç®±éªŒè¯ç ...
   âœ… é‚®ç®±éªŒè¯ç å‘é€æˆåŠŸ: éªŒè¯ç å·²å‘é€è‡³é‚®ç®± test_1704876543@example.com
   ğŸ”‘ MockéªŒè¯ç : 654321
   ğŸ“ ä½¿ç”¨éªŒè¯ç æ³¨å†Œ...
   âœ… é‚®ç®±æ³¨å†ŒæˆåŠŸ: ç”¨æˆ·test_1704876543 (test_1704876543@example.com)
   ```
   
   > æ³¨æ„ï¼šç”¨æˆ·åä¼šæ ¹æ®é‚®ç®±å‰ç¼€è‡ªåŠ¨ç”Ÿæˆï¼Œæ ¼å¼ä¸º"ç”¨æˆ·{é‚®ç®±å‰ç¼€}"

### ğŸ“ åœºæ™¯4ï¼šæ‰‹æœºæ³¨å†Œæµ‹è¯•

1. ç‚¹å‡» **"æ‰‹æœºæ³¨å†Œ"** æŒ‰é’®
2. ç³»ç»Ÿç”Ÿæˆéšæœºæ‰‹æœºå·è¿›è¡Œæµ‹è¯•
3. æŸ¥çœ‹æ³¨å†Œæµç¨‹æ—¥å¿—

### ğŸ”‘ åœºæ™¯5ï¼šå¯†ç é‡ç½®æµ‹è¯•

1. ç‚¹å‡» **"å¯†ç é‡ç½®"** æŒ‰é’®
2. ä½¿ç”¨é¢„è®¾çš„æµ‹è¯•é‚®ç®±è¿›è¡Œå¯†ç é‡ç½®
3. è§‚å¯Ÿé‡ç½®æµç¨‹

### ğŸ” åœºæ™¯6ï¼šè´¦å·çŠ¶æ€æ£€æŸ¥

1. ç‚¹å‡» **"è´¦å·æ£€æŸ¥"** æŒ‰é’®
2. æŸ¥çœ‹é¢„è®¾è´¦å·çš„å­˜åœ¨å’ŒéªŒè¯çŠ¶æ€ï¼š
   ```
   ğŸ“§ é‚®ç®± user@greentech.com - å­˜åœ¨: true, å·²éªŒè¯: true
   ğŸ“± æ‰‹æœº 13800138000 - å­˜åœ¨: true, å·²éªŒè¯: true
   ```

## ğŸ® äº’åŠ¨æµ‹è¯•ä½“éªŒ

### æµ‹è¯•é¢„è®¾è´¦å·

ç³»ç»Ÿé¢„è®¾äº†3ä¸ªæµ‹è¯•è´¦å·ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼š

| è´¦å·ç±»å‹ | é‚®ç®± | æ‰‹æœºå· | å¯†ç  | ç”¨æˆ·å | è§’è‰² |
|---------|------|--------|------|------|------|
| ç®¡ç†å‘˜ | admin@greentech.com | 13800138000 | 123456 | ç³»ç»Ÿç®¡ç†å‘˜ | admin |
| æ™®é€šç”¨æˆ· | user@greentech.com | 13900139000 | 123456 | æµ‹è¯•ç”¨æˆ· | user |
| æ¼”ç¤ºè´¦æˆ· | demo@example.com | 18800188000 | 123456 | æ¼”ç¤ºè´¦æˆ· | user |

> æ–°æ³¨å†Œç”¨æˆ·çš„ç”¨æˆ·åè‡ªåŠ¨ç”Ÿæˆè§„åˆ™ï¼š
> - é‚®ç®±æ³¨å†Œï¼šç”¨æˆ·{é‚®ç®±å‰ç¼€}ï¼Œå¦‚ "ç”¨æˆ·admin"
> - æ‰‹æœºæ³¨å†Œï¼šç”¨æˆ·{æ‰‹æœºå·å4ä½}ï¼Œå¦‚ "ç”¨æˆ·8000"

### æ‰‹åŠ¨æµ‹è¯•æ­¥éª¤

1. **å¼€æ”¾æµè§ˆå™¨æ§åˆ¶å°** (F12 â†’ Console)
2. **ä¾æ¬¡ç‚¹å‡»æµ‹è¯•æŒ‰é’®** è§‚å¯Ÿå®æ—¶æ—¥å¿—
3. **æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º** è·å–éªŒè¯ç ç­‰è¯¦ç»†ä¿¡æ¯
4. **ä½¿ç”¨"æ¸…é™¤æ•°æ®"æŒ‰é’®** é‡ç½®æµ‹è¯•çŠ¶æ€

## ğŸ”§ åœ¨ç»„ä»¶ä¸­ä½¿ç”¨è®¤è¯API

### åŸºç¡€ç”¨æ³•ç¤ºä¾‹

```tsx
import { useState } from 'react';
import { authApi } from '@/api/auth';

function LoginComponent() {
  const [loading, setLoading] = useState(false);

  const handleLogin = async () => {
    setLoading(true);
    try {
      const result = await authApi.passwordLogin({
        account: 'user@example.com',
        password: '123456',
        type: 'email'
      });
      
      if (result.success) {
        console.log('ç™»å½•æˆåŠŸ:', result.data?.user);
        // ä¿å­˜tokenåˆ°localStorage
        localStorage.setItem('access_token', result.data!.token);
      } else {
        console.error('ç™»å½•å¤±è´¥:', result.error);
      }
    } catch (error) {
      console.error('ç™»å½•å¼‚å¸¸:', error);
    } finally {
      setLoading(false);
    }
  };

  return (
    <button onClick={handleLogin} disabled={loading}>
      {loading ? 'ç™»å½•ä¸­...' : 'ç™»å½•'}
    </button>
  );
}
```

### éªŒè¯ç å‘é€ç¤ºä¾‹

```tsx
import { useState } from 'react';
import { authApi, AuthMockManager } from '@/api/auth';

function CodeSendComponent() {
  const [countdown, setCountdown] = useState(0);

  const sendCode = async () => {
    try {
      const result = await authApi.sendPhoneCode({
        phone: '13800138000',
        purpose: 'login'
      });
      
      if (result.success) {
        alert('éªŒè¯ç å·²å‘é€');
        
        // Mockæ¨¡å¼ä¸‹å¯ä»¥è·å–éªŒè¯ç ç”¨äºè‡ªåŠ¨å¡«å……
        if (process.env.NEXT_PUBLIC_USE_MOCK === 'true') {
          const mockCode = AuthMockManager.getMockCode('13800138000', undefined, 'login');
          console.log('MockéªŒè¯ç :', mockCode);
        }
        
        // å¼€å§‹60ç§’å€’è®¡æ—¶
        setCountdown(60);
        const timer = setInterval(() => {
          setCountdown((prev) => {
            if (prev <= 1) {
              clearInterval(timer);
              return 0;
            }
            return prev - 1;
          });
        }, 1000);
      }
    } catch (error) {
      console.error('å‘é€éªŒè¯ç å¤±è´¥:', error);
    }
  };

  return (
    <button onClick={sendCode} disabled={countdown > 0}>
      {countdown > 0 ? `${countdown}s` : 'å‘é€éªŒè¯ç '}
    </button>
  );
}
```

## ğŸ“Š çœŸå®APIåˆ‡æ¢

å½“åç«¯APIå‡†å¤‡å°±ç»ªæ—¶ï¼Œå¯ä»¥è½»æ¾åˆ‡æ¢åˆ°çœŸå®APIï¼š

### 1. ä¿®æ”¹ç¯å¢ƒé…ç½®

å°† `.env.local` ä¸­çš„é…ç½®æ”¹ä¸ºï¼š

```env
# å…³é—­Mockæ¨¡å¼
NEXT_PUBLIC_USE_MOCK=false

# é…ç½®çœŸå®çš„åç«¯APIåœ°å€
NEXT_PUBLIC_API_URL=http://your-backend-server:8080/api
```

### 2. é‡å¯å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

### 3. ä½¿ç”¨ç›¸åŒçš„æµ‹è¯•é¡µé¢

è®¿é—® `http://localhost:3000/auth-test` é¡µé¢ä¼šæ˜¾ç¤ºï¼š
- ğŸ”´ çœŸå®API æ¨¡å¼
- æ‰€æœ‰æ¥å£è¯·æ±‚å°†å‘é€åˆ°çœŸå®åç«¯

## ğŸš€ æŠ•å…¥ç”Ÿäº§ä½¿ç”¨

### ç¯å¢ƒå˜é‡é…ç½®

ç”Ÿäº§ç¯å¢ƒçš„ `.env.production` é…ç½®ï¼š

```env
# ç”Ÿäº§ç¯å¢ƒå¿…é¡»å…³é—­Mock
NEXT_PUBLIC_USE_MOCK=false

# ç”Ÿäº§APIåœ°å€
NEXT_PUBLIC_API_URL=https://api.yourapp.com/api
```

### ç§»é™¤æµ‹è¯•é¡µé¢

ç”Ÿäº§éƒ¨ç½²å‰è®°å¾—ç§»é™¤æµ‹è¯•ç›¸å…³æ–‡ä»¶ï¼š

```bash
# åˆ é™¤æµ‹è¯•é¡µé¢
rm -rf src/app/auth-test
rm -f src/components/auth/auth-test-panel.tsx
rm -f src/api/authMockManager.ts
```

## ğŸ’¡ å¼€å‘æŠ€å·§

### 1. è°ƒè¯•éªŒè¯ç 

Mockæ¨¡å¼ä¸‹ï¼ŒéªŒè¯ç ä¼šåœ¨æ§åˆ¶å°æ˜¾ç¤ºï¼Œæ–¹ä¾¿è°ƒè¯•ï¼š

```javascript
// æµè§ˆå™¨æ§åˆ¶å°ä¼šæ˜¾ç¤º
ğŸ“± æ‰‹æœºéªŒè¯ç å·²å‘é€åˆ° +86 13800138000ï¼ŒéªŒè¯ç ï¼š123456 (æµ‹è¯•æ¨¡å¼)
```

### 2. å¿«é€Ÿé‡ç½®çŠ¶æ€

ç‚¹å‡»"æ¸…é™¤æ•°æ®"æŒ‰é’®æˆ–ä»£ç ä¸­è°ƒç”¨ï¼š

```typescript
import { AuthMockManager } from '@/api/authMockManager';
AuthMockManager.clearMockData();
```

### 3. è‡ªå®šä¹‰Mockå“åº”

ä¿®æ”¹ `authMockManager.ts` ä¸­çš„å“åº”æ•°æ®å’Œå»¶è¿Ÿæ—¶é—´ã€‚

## ğŸ‰ æ€»ç»“

é€šè¿‡Mockæµ‹è¯•ç³»ç»Ÿï¼Œæ‚¨å¯ä»¥ï¼š

- âœ… **æ— éœ€åç«¯ä¾èµ–** - ç‹¬ç«‹å¼€å‘å’Œæµ‹è¯•å‰ç«¯åŠŸèƒ½
- âœ… **å®Œæ•´è¦†ç›–åœºæ™¯** - æµ‹è¯•æ‰€æœ‰è®¤è¯ç›¸å…³åŠŸèƒ½
- âœ… **çœŸå®æ¨¡æ‹Ÿä½“éªŒ** - åŒ…å«ç½‘ç»œå»¶è¿Ÿå’Œé”™è¯¯å¤„ç†
- âœ… **å¼€å‘æ•ˆç‡æå‡** - å¿«é€Ÿè¿­ä»£å’Œè°ƒè¯•
- âœ… **æ— ç¼åˆ‡æ¢** - è½»æ¾ä»Mockåˆ‡æ¢åˆ°çœŸå®API

ç°åœ¨å°±å¼€å§‹ä½“éªŒå§ï¼è®¿é—® `/auth-test` é¡µé¢å¼€å§‹æ‚¨çš„æµ‹è¯•ä¹‹æ—…ã€‚ ğŸš€